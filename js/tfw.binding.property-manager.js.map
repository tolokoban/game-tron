{"version":3,"sources":["tfw.binding.property-manager.js"],"names":["require","module","exports","_","D","X","intl","arguments","all","constructor","isLinkable","getAllAttributesNames","getProperties","readonly","Event","ID","CONTAINER_SYMBOL","PROPERTY_SYMBOL","PropertyManager","container","Object","defineProperty","value","writable","configurable","enumerable","name","id","_props","_container","prototype","set","propertyName","create","get","propertyId","fire","wave","prop","event","change","converter","currentValue","alwaysFired","areDifferent","that","exec","Error","delay","parseFloat","isNaN","on","action","add","off","remove","fail","pm","ex","console","error","undefined","keys","property","properties","Array","isArray","options","p","createNewProperty","call","applyAttributesToTarget","source","target","attName","attValue","filter","functionOrUndefined","castPositiveInteger","manager","timeout","createGetter","createSetter","init","bind","v","newValue","addPropToValue","setter","cast","removePropFromValue","castedValue","isContentChangeAware","indexOf","push","pos","splice","createAction","clearTimeout","setTimeout","msg","Math","max","floor","f","oldValue","attribs","attribNames","forEach"],"mappings":"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","sourcesContent":["/** @module tfw.binding.property-manager */require( 'tfw.binding.property-manager', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\n   \"use strict\";\n\n/**\n * @export\n * @function\n * @param {object} container - Object which will hold properties.\n */\nmodule.exports = constructor;\n\n/**\n * @export .isLinkable\n * Look if an object  has a property manager assigned to  it and own a\n * property which name is `propertyName`.\n */\nmodule.exports.isLinkable = isLinkable;\n\nmodule.exports.getAllAttributesNames = getAllAttributesNames;\n\n/**\n * Return the linkable properties which holds this value, or `null`.\n */\nmodule.exports.getProperties = getProperties;\n\n/**\n * Create a readonly attribute.\n *\n * @param {object} target - Object which will bear the readonly attribute.\n * @param {object} attribs - Attributes with their values.\n * @returns {undefined}\n */\nmodule.exports.readonly = readonly;\n\nconst Event = require( \"tfw.event\" );\n\nlet ID = 0;\n\n// A container  with linkable  properties has  an attribute  with this\n// name. This attribute own the list of linkable properties.\nconst CONTAINER_SYMBOL = \"__tfw.property-manager__\";\n// A linkable property owned by a container has an attribute with this\n// name. This attribute give the name  of the property and a reference\n// to the container.\nconst PROPERTY_SYMBOL = '__tfw.binding.property-manager__';\n\n/**\n *\n */\nfunction PropertyManager( container ) {\n    Object.defineProperty( this, 'id', {\n        value: ID++,\n        writable: false,\n        configurable: false,\n        enumerable: true\n    } );\n    this.name = this.id;\n    this._props = {};\n    this._container = container;\n}\n\n/**\n * @class PropertyManager\n * @member set\n * Set the inner value of a property without fireing any event.\n * @param {string} propertyName.\n * @param {any} value.\n */\nPropertyManager.prototype.set = function ( propertyName, value ) {\n    this.create( propertyName ).set( value );\n};\n\n/**\n * Look if `propertyName` is a linkable property of this object.\n */\nPropertyManager.prototype.isLinkable = function ( propertyName ) {\n    var container = this._container;\n    if ( !container ) return false;\n    if ( typeof container[ CONTAINER_SYMBOL ] === 'undefined' ) return false;\n    return typeof container[ CONTAINER_SYMBOL ]._props[ propertyName ] !== 'undefined';\n\n};\n\n/**\n * @class PropertyManager\n * @member get\n * @param {string} propertyName.\n * @return {any} Inner value of the property.\n *\n */\nPropertyManager.prototype.get = function ( propertyName ) {\n    return this.create( propertyName ).get();\n};\n\nPropertyManager.prototype.propertyId = function ( propertyName ) {\n    return this.create( propertyName ).id;\n};\n\nPropertyManager.prototype.fire = function ( propertyName, wave ) {\n    var prop = this.create( propertyName );\n    prop.event.fire( prop.get(), propertyName, this._container, wave );\n};\n\nPropertyManager.prototype.change = function ( propertyName, value, wave ) {\n    if ( typeof wave === 'undefined' ) wave = [];\n\n    var prop = this.create( propertyName );\n\n    var converter = prop.converter;\n    if ( typeof converter === 'function' ) {\n        value = converter( value );\n    }\n\n    var currentValue = prop.get();\n    if ( prop.alwaysFired || areDifferent( value, currentValue ) ) {\n        prop.set( value );\n        var that = this;\n        exec( prop, function () {\n            // Fire change event.\n            that.fire( propertyName, wave );\n        } );\n    }\n};\n\n/**\n * @class PropertyManager\n * @member converter\n * @param {string} propertyName.\n * @param {function=undefined} converter -  Converter is assigned only\n * if it is a function.\n * @return {function} Current converter.\n */\nPropertyManager.prototype.converter = function ( propertyName, converter ) {\n    var prop = this.create( propertyName );\n    if ( typeof converter === 'function' ) {\n        prop.converter = converter;\n    } else if ( typeof converter !== 'undefined' ) {\n        throw Error(\n            \"[tfw.binding.property-manager::converter] \" +\n            \"`converter` must be of type function or undefined!\"\n        );\n    }\n    return prop.converter;\n};\n\nPropertyManager.prototype.delay = function ( propertyName, delay ) {\n    var prop = this.create( propertyName );\n    delay = parseFloat( delay );\n    if ( isNaN( delay ) ) return prop.delay;\n    prop.delay = delay;\n};\n\n/**\n * @class PropertyManager\n * @member on\n * @param {string} propertyName.\n * @param {function(val,name,container)} action  - Function to execute\n * when a property changed.\n */\nPropertyManager.prototype.on = function ( propertyName, action ) {\n    var prop = this.create( propertyName );\n    prop.event.add( action );\n};\n\n/**\n * @class PropertyManager\n * @member off\n * @param {string} propertyName.\n * @param {function(val,name,container)} action  - Function to execute\n * when a property changed.\n */\nPropertyManager.prototype.off = function ( propertyName, action ) {\n    var prop = this.create( propertyName );\n    prop.event.remove( action );\n};\n\n\n/**\n * @export\n * @function\n * @param {object} container - Object which will hold properties.\n */\nfunction constructor( container ) {\n    try {\n        if ( typeof container === 'undefined' ) {\n            fail( \"Argument `container` is mandatory!\" );\n        }\n        if ( typeof container !== 'object' ) return null;\n\n        let pm = container[ CONTAINER_SYMBOL ];\n        if ( !pm ) {\n            pm = new PropertyManager( container );\n            container[ CONTAINER_SYMBOL ] = pm;\n        }\n        return pm;\n    } catch ( ex ) {\n        console.error( ex );\n        return null;\n    }\n}\n\n/**\n * @export .isLinkable\n * Look if an object  has a property manager assigned to  it and own a\n * property which name is `propertyName`.\n */\nfunction isLinkable( container, propertyName ) {\n    if ( typeof container[ CONTAINER_SYMBOL ] === \"undefined\" ) return false;\n    if ( typeof propertyName !== 'string' ) return true;\n    return typeof container[ CONTAINER_SYMBOL ]._props[ propertyName ] !== \"undefined\";\n};\n\nfunction getAllAttributesNames( container ) {\n    if ( container[ CONTAINER_SYMBOL ] === undefined ) return [];\n    return Object.keys( container[ CONTAINER_SYMBOL ]._props );\n};\n\n/**\n * Return the linkable properties which holds this value, or `null`.\n */\nfunction getProperties( property ) {\n    var properties = property[ PROPERTY_SYMBOL ];\n    if ( !Array.isArray( properties ) ) return null;\n    return properties;\n};\n\n/**\n * @export .create\n * Create an new linkable property.\n * @param {string} propertyName - Name of the property.\n * @param {any} options.init - Initial value. Won't fire any change notification.\n * @param {function=undefined} options.get - Special getter.\n * @param {function=undefined} options.set - Special setter.\n * @param {function=undefined}  options.cast - Conversion to  apply to\n * the value before setting it.\n */\nPropertyManager.prototype.create = function ( propertyName, options ) {\n    var that = this;\n    if ( typeof propertyName !== 'string' ) fail( \"propertyName must be a string!\" );\n    var p = this._props[ propertyName ];\n    if ( !p ) {\n        if ( typeof options === 'undefined' ) options = {};\n        p = createNewProperty.call( this, propertyName, options );\n    }\n    return p;\n};\n\n/**\n * Copy all the attributes of `source` into `target`.\n */\nfunction applyAttributesToTarget( source, target ) {\n    var attName, attValue;\n    for ( attName in source ) {\n        if ( module.exports.isLinkable( target, attName ) ) {\n            attValue = source[ attName ];\n            target[ attName ] = attValue;\n        }\n    }\n}\n\nfunction createNewProperty( propertyName, options ) {\n    var that = this;\n\n    var prop = {\n        value: undefined,\n        event: new Event(),\n        filter: functionOrUndefined( options.filter ),\n        converter: functionOrUndefined( options.converter ),\n        delay: castPositiveInteger( options.delay ),\n        action: null,\n        alwaysFired: options.alwaysFired ? true : false,\n        manager: this,\n        name: propertyName,\n        timeout: 0\n    };\n    prop.get = createGetter( prop, options );\n    prop.set = createSetter( prop, options, that, propertyName );\n\n    this._props[ propertyName ] = prop;\n    if ( typeof options.init !== 'undefined' ) {\n        prop.set( options.init );\n    }\n\n    Object.defineProperty( this._container, propertyName, {\n        get: prop.get.bind( prop ),\n        set: that.change.bind( that, propertyName ),\n        enumerable: true,\n        configurable: false\n    } );\n\n    return prop;\n}\n\nfunction createGetter( prop, options ) {\n    if ( typeof options.get === 'function' ) {\n        return function ( v ) {\n            var newValue = options.get( v );\n            addPropToValue( prop, newValue );\n            return newValue;\n        };\n    }\n    return function ( v ) {\n        return prop.value;\n    };\n}\n\nfunction createSetter( prop, options, that, propertyName ) {\n    var setter;\n    if ( typeof options.cast === 'function' ) {\n        if ( typeof options.set === 'function' ) {\n            setter = function ( v ) {\n                removePropFromValue( prop, prop.get() );\n                var castedValue = options.cast( v, that );\n                addPropToValue( prop, prop.value );\n                options.set( castedValue );\n            };\n        } else {\n            setter = function ( v ) {\n                removePropFromValue( prop, prop.get() );\n                prop.value = options.cast( v, that );\n                addPropToValue( prop, prop.value );\n            };\n        }\n    } else {\n        setter = typeof options.set === 'function' ? options.set : function ( v ) {\n            removePropFromValue( prop, prop.get() );\n            prop.value = v;\n            addPropToValue( prop, prop.value );\n        };\n    }\n    return setter;\n}\n\n/**\n * Add an `info` attribute to the  property's value. This is useful to\n * find the container and the property name from the value.\n */\nfunction addPropToValue( prop, value ) {\n    if ( value === undefined || value === null ) return;\n    if ( value.isContentChangeAware !== true ) return;\n    var properties = value[ PROPERTY_SYMBOL ];\n    if ( !Array.isArray( properties ) ) {\n        properties = [ prop ];\n    } else if ( properties.indexOf( prop ) === -1 ) {\n        properties.push( prop );\n    }\n    value[ PROPERTY_SYMBOL ] = properties;\n}\n\nfunction removePropFromValue( prop, value ) {\n    if ( value === undefined || value === null ) return;\n    if ( value.isContentChangeAware !== true ) return;\n    var properties = value[ PROPERTY_SYMBOL ];\n    if ( !Array.isArray( properties ) ) return;\n    var pos = properties.indexOf( prop );\n    if ( pos === -1 ) return;\n    properties.splice( pos, 1 );\n}\n\n/**\n * This is a special property which emit a change event as soon as any\n * value is set  to it, even if  this value has already  been set just\n * before. Moreover, the  value of this attribute is  always its name.\n * This is used for action properties in buttons, for instance.\n */\nPropertyManager.prototype.createAction = function ( propertyName, options ) {\n    if ( typeof options === 'undefined' ) options = {};\n    options.alwaysFired = true;\n    return this.create( propertyName, options );\n};\n\n\n/**\n * Most  of  the  time,  `action` is  called  immediatly  without  any\n * argument. But  you can configure  your property with a  `delay`. If\n * you do so, the action is only called after this `delay`(in ms). The\n * `action`can be lost  if another call to `exec()`  occurs before the\n * end of the `delay` and the `delay` is reset.\n */\nfunction exec( prop, action ) {\n    if ( !prop.delay ) action();\n    else {\n        clearTimeout( prop.timeout );\n        prop.timeout = setTimeout( action, prop.delay );\n    }\n};\n\n\nfunction fail( msg, source ) {\n    if ( typeof source === 'undefined' ) {\n        source = \"\";\n    } else {\n        source = \"::\" + source;\n    }\n    throw Error( \"[tfw.binding.property-manager\" + source + \"] \" + msg );\n}\n\nfunction castPositiveInteger( v ) {\n    if ( typeof v !== 'number' ) return 0;\n    if ( isNaN( v ) ) return 0;\n    return Math.max( 0, Math.floor( v ) );\n}\n\nfunction functionOrUndefined( f ) {\n    if ( typeof f === 'function' ) return f;\n    return undefined;\n}\n\n/**\n * A linkable property must link only if  we set a new value to it. If\n * the value  is a  List, we need  to check if  they have  a different\n * inner array because different Lists can share the same array and in\n * this cas, we don't want to fire a changed event.\n */\nfunction areDifferent( oldValue, newValue ) {\n    return oldValue !== newValue;\n}\n\n\n/**\n * Create a readonly attribute.\n *\n * @param {object} target - Object which will bear the readonly attribute.\n * @param {object} attribs - Attributes with their values.\n * @returns {undefined}\n */\nfunction readonly( target, attribs ) {\n    const attribNames = Object.keys( attribs );\n    attribNames.forEach( function ( attName ) {\n        const attValue = attribs[ attName ];\n        if ( typeof attValue === 'function' ) {\n            Object.defineProperty(\n                target,\n                attName, {\n                    set() {\n                        throw Error( `Attribute \"${attName}\" is read only!` );\n                    },\n                    get: attValue,\n                    configurable: false,\n                    enumerable: true\n                }\n            );\n        } else {\n            Object.defineProperty(\n                target,\n                attName, {\n                    value: attValue,\n                    writable: false,\n                    configurable: false,\n                    enumerable: true\n                }\n            );\n        }\n    } );\n}\n\n\nmodule.exports._ = _;\n})"]}