{"version":3,"sources":["app.js"],"names":["require","module","exports","_","Dom","Car","Action","Polyline","start","canvas","ctx","getContext","player","action","create","type","x","y","dir","color","ennemy","targets","cars","boundaries","createBoundaries","car","setAttribute","clientWidth","clientHeight","anim","time","window","requestAnimationFrame","clearRect","width","height","boundary","paintPolyline","isDead","polyline","x0","lastX","y0","lastY","move","x1","y1","obstacle","collide","console","log","w","h","add","beginPath","moveTo","firstX","firstY","foreachTail","lineTo","strokeStyle","stroke"],"mappings":"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","sourcesContent":["/** @module s3/app */require( 's3/app', function(require, module, exports) { var _=function(){return ''};   \"use strict\";\r\n\r\nconst Dom = require(\"dom\"),\r\n      Car = require(\"s3/car\"),\r\n      Action = require(\"s3/tron.action\"),\r\n      Polyline = require(\"s3/polyline\");\r\n\r\n\r\nexports.start = function() {\r\n    const canvas = Dom(\"canvas\"),\r\n          ctx = canvas.getContext( \"2d\" ),\r\n          player = new Car( {\r\n              action: Action.create({ type: \"keyboard\" }),\r\n              x: 12,\r\n              y: 200,\r\n              dir: 1,\r\n              color: \"#f80\"\r\n          } ),\r\n          ennemy = new Car( {\r\n              action: Action.create({ type: \"ai\", targets: [player] }),\r\n              x: 500,\r\n              y: 312,\r\n              dir: 3,\r\n              color: \"#789\"\r\n          } ),\r\n          cars = [player, ennemy],\r\n          boundaries = createBoundaries();\r\n\r\n    ennemy.action.car = ennemy;\r\n    ennemy.action.cars = cars;\r\n    ennemy.action.boundaries = boundaries;\r\n\r\n    canvas.setAttribute( \"width\", canvas.clientWidth );\r\n    canvas.setAttribute( \"height\", canvas.clientHeight );\r\n\r\n    function anim( time ) {\r\n        window.requestAnimationFrame( anim );\r\n\r\n        ctx.clearRect( 0, 0, canvas.width, canvas.height );\r\n\r\n        for( const boundary of boundaries ) {\r\n            paintPolyline( ctx, boundary, \"#fff\" );\r\n        }\r\n\r\n        for( const car of cars) {\r\n            if( car.isDead ) continue;\r\n\r\n            paintPolyline( ctx, car.polyline, car.color );\r\n\r\n            const x0 = car.polyline.lastX,\r\n                  y0 = car.polyline.lastY;\r\n            car.move( time );\r\n            const x1 = car.polyline.lastX,\r\n                  y1 = car.polyline.lastY;\r\n\r\n            for( const obstacle of cars ) {\r\n                if( obstacle.isDead ) continue;\r\n                if( obstacle.polyline.collide( x0, y0, x1, y1 ) ) {\r\n                    car.isDead = true;\r\n                    console.log( \"DEAD!\" );\r\n                    break;\r\n                }\r\n            }\r\n            if( !car.isDead ) {\r\n                for( const boundary of boundaries ) {\r\n                    if( boundary.collide( x0, y0, x1, y1 ) ) {\r\n                        car.isDead = true;\r\n                        console.log( \"DEAD in boundary!\" );\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    window.requestAnimationFrame( anim );\r\n};\r\n\r\n\r\nfunction createBoundaries( w = 512, h = 512 ) {\r\n    const polyline = new Polyline( 5, 55 );\r\n    polyline.move( 0, h - 110 );\r\n    polyline.add();\r\n    polyline.move( 50, 0 );\r\n    polyline.add();\r\n    polyline.move( 0, 50 );\r\n    polyline.add();\r\n    polyline.move( w - 110, 0 );\r\n    polyline.add();\r\n    polyline.move( 0, -50 );\r\n    polyline.add();\r\n    polyline.move( 50, 0 );\r\n    polyline.add();\r\n    polyline.move( 0, 110 - h );\r\n    polyline.add();\r\n    polyline.move( -50, 0 );\r\n    polyline.add();\r\n    polyline.move( 0, -50 );\r\n    polyline.add();\r\n    polyline.move( 110 - w, 0 );\r\n    polyline.add();\r\n    polyline.move( 0, 50 );\r\n    polyline.add();\r\n    polyline.move( -50, 0 );\r\n\r\n    return [polyline];\r\n}\r\n\r\n\r\nfunction paintPolyline( ctx, polyline, color ) {\r\n    ctx.beginPath();\r\n    ctx.moveTo( polyline.firstX, polyline.firstY );\r\n    polyline.foreachTail( (x, y) => ctx.lineTo( x, y ) );\r\n    ctx.strokeStyle = color;\r\n    ctx.stroke();\r\n}\r\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}