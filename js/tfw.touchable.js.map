{"version":3,"sources":["tfw.touchable.js"],"names":["require","module","exports","_","D","X","intl","arguments","all","Touchable","$","Fx","Listeners","elem","opts","that","target","shadow","div","container","enabled","color","classToAdd","opacity","element","tap","press","lastX","lastY","addClass","fxDown","css","transition","transform","exec","cls","rect","getBoundingClientRect","w","Math","max","width","h","height","radius","ceil","sqrt","left","top","margin","background","clear","wait","detach","removeClass","on","down","evt","stopPropagation","preventDefault","floor","x","y","makeFixedElementWithSameShape","add","document","body","start","console","log","fire","doubletap","copy","borderRadius","window","getComputedStyle","getPropertyValue"],"mappings":"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","sourcesContent":["/** @module tfw.touchable */require( 'tfw.touchable', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\n   \"use strict\";\n\n/**\n * @module tfw.touchable\n *\n * @description\n * Turn  a DOM  element  into  a touchable  one  with material  design\n * animation: a growing transparent disk.\n *\n * @example\n * var Touchable = require('tfw.touchable');\n * var div = document.querySelector('#button');\n * var touchable = new Touchable( div, {\n *   opacity: .2,\n *   color: \"white\"\n * });\n * touchable.tap.add(function() { ... });\n * touchable.press.add(function() { ... });\n */\nmodule.exports = Touchable;\n\nconst $ = require(\"dom\"),\n    Fx = require(\"dom.fx\"),\n    Listeners = require(\"tfw.listeners\");\n\n/**\n * @class Touchable\n * @param {any} elem - DOMElement or string representing a DOM ID.\n * @param {object} opts - Options.\n * @param {boolean} opts.enabled - .\n * @param {string} opts.color - CSS color.\n * @returns {undefined}\n */\nfunction Touchable(elem, opts = {}) {\n    const that = this,\n        target = {elem: null},\n        shadow = $.div(\"tfw-touchable-shadow\"),\n        container = $.div(\"tfw-touchable-container\", [shadow]);\n\n    if (typeof opts.enabled === \"undefined\") opts.enabled = true;\n\n    this.enabled = opts.enabled;\n    this.color = opts.color || \"#333\";\n    this.classToAdd = opts.classToAdd;\n    this.opacity = opts.opacity || 0.4;\n    this.element = $(elem);\n    this.tap = new Listeners();\n    this.press = new Listeners();\n\n    let lastX = 0,\n        lastY = 0;\n\n    $.addClass(elem, \"tfw-touchable-elem\");\n\n    const fxDown = Fx()\n        .css(shadow, {\n            transition: \"none\",\n            transform: \"scale(0)\"\n        })\n        .exec(function() {\n            const cls = that.classToAdd;\n            if (typeof cls === \"string\") {\n                $.addClass(elem, cls);\n            }\n            const rect = target.elem.getBoundingClientRect(),\n                w = Math.max(lastX, rect.width - lastX),\n                h = Math.max(lastY, rect.height - lastY),\n                radius = Math.ceil(Math.sqrt(w * w + h * h));\n            $.css(shadow, {\n                left: `${lastX}px`,\n                top: `${lastY}px`,\n                margin: `-${radius}px`,\n                width: `${2 * radius}px`,\n                height: `${2 * radius}px`,\n                opacity: 0,\n                background: that.color,\n                transform: \"scale(0)\",\n                transition: \"all .15s ease\",\n                \"transition-timing-function\": \"cubic-bezier(0,1,0.780,1)\",\n                \"-moz-transition-timing-function\": \"cubic-bezier(0,1,0.780,1)\",\n                \"-webkit-transition-timing-function\":\n                    \"cubic-bezier(0,1,0.780,1)\"\n            });\n            $.clear(target.elem, container);\n        })\n        .wait(10)\n        .css(shadow, {\n            opacity: that.opacity,\n            transform: \"scale(.25)\"\n        })\n        .wait(150)\n        .css(shadow, {transform: \"scale(.2)\"})\n        .wait(150)\n        .css(shadow, {\n            transition: \"all .6s ease\",\n            transform: \"scale(1)\",\n            opacity: 0\n        })\n        .wait(600)\n        .exec(function() {\n            $.detach(target.elem);\n            const cls = that.classToAdd;\n            if (typeof cls === \"string\") {\n                $.removeClass(elem, cls);\n            }\n        });\n\n    $.on(elem, {\n        down(evt) {\n            if (!that.enabled) return;\n            evt.stopPropagation();\n            evt.preventDefault();\n            lastX = Math.floor(evt.x);\n            lastY = Math.floor(evt.y);\n            target.elem = makeFixedElementWithSameShape(elem);\n            $.add(document.body, target.elem);\n            fxDown.start();\n        },\n        tap(evt) {\n            if (!that.enabled) {\n                console.log(\"DISABLED!\");\n                return;\n            }\n            that.tap.fire(evt);\n        },\n        doubletap(evt) {\n            if (!that.enabled) {\n                console.log(\"DISABLED!\");\n                return;\n            }\n            that.press.fire(evt);\n        }\n    });\n}\n\n/**\n * @param {DOMElement} elem - Element from which to make a new element with the same shape but fixed.\n * @returns {undefined}\n */\nfunction makeFixedElementWithSameShape(elem) {\n    const rect = $(elem).getBoundingClientRect(),\n        copy = $.div(\"tfw-touchable\");\n\n    $.css(copy, {\n        left: `${rect.left}px`,\n        top: `${rect.top}px`,\n        width: `${rect.width}px`,\n        height: `${rect.height}px`,\n        borderRadius: window\n            .getComputedStyle($(elem))\n            .getPropertyValue(\"border-radius\")\n    });\n    return copy;\n}\n\n\n\nmodule.exports._ = _;\n})"]}