"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}require("s3.tron.action.ai",function(require,module,exports){function rollDice(){return Math.random()*1000}var _require=require("common"),readonly=_require.readonly,NONE=0,LEFT=1,RIGHT=2,ACCEL=3,Ai=function(){function Ai(_ref){var car=_ref.car,cars=_ref.cars,boundaries=_ref.boundaries,_ref$reaction=_ref.reaction,reaction=void 0===_ref$reaction?150:_ref$reaction,_ref$frontRadar=_ref.frontRadar,frontRadar=void 0===_ref$frontRadar?10:_ref$frontRadar,_ref$sideRadar=_ref.sideRadar,sideRadar=void 0===_ref$sideRadar?20:_ref$sideRadar;_classCallCheck(this,Ai);var that=this;this.status=NONE,this.car=car,this.cars=cars,this.boundaries=boundaries,this.lastTime=0,readonly(this,{reaction:reaction,frontRadar:frontRadar,sideRadar:sideRadar,actionRight:function actionRight(){return that.status===RIGHT},actionLeft:function actionLeft(){return that.status===LEFT},actionAccel:function actionAccel(){return that.status===ACCEL}})}return _createClass(Ai,[{key:"process",value:function process(time){if(time-this.lastTime<this.reaction)return void(this.status=NONE);var car=this.car,x0=car.polyline.lastX,y0=car.polyline.lastY,x1=x0+car.vx*this.frontRadar,y1=y0+car.vy*this.frontRadar;if(this.collide(x0,y0,x1,y1))rollDice()<1e3*.5?this.turnRightIfSafe():this.turnLeftIfSafe();else{var rnd=rollDice();3>rnd?this.turnRightIfSafe():6>rnd?this.turnLeftIfSafe():8>rnd?this.status=ACCEL:this.status=NONE}this.status!==NONE&&(this.lastTime=time)}},{key:"turnRightIfSafe",value:function turnRightIfSafe(){var car=this.car,x0=car.polyline.lastX,y0=car.polyline.lastY,x1R=x0+car.vxRight*this.sideRadar,y1R=y0+car.vyRight*this.sideRadar;this.status=this.collide(x0,y0,x1R,y1R)?NONE:RIGHT}},{key:"turnLeftIfSafe",value:function turnLeftIfSafe(){var car=this.car,x0=car.polyline.lastX,y0=car.polyline.lastY,x1L=x0+car.vxLeft*this.sideRadar,y1L=y0+car.vyLeft*this.sideRadar;this.status=this.collide(x0,y0,x1L,y1L)?NONE:LEFT}},{key:"collide",value:function collide(x0,y0,x1,y1){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,obstacle,_iterator=this.cars[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)if(obstacle=_step.value,!obstacle.isDead&&obstacle.polyline.collide(x0,y0,x1,y1))return!0}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,boundary,_iterator2=this.boundaries[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0)if(boundary=_step2.value,boundary.collide(x0,y0,x1,y1))return!0}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return!1}}]),Ai}();exports.create=function(args){return new Ai(args)},module.exports._=function _(){return""}});