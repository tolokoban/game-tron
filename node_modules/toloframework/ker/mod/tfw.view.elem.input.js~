"use strict";

var Binding = require("tfw.binding");

function Input( args ) {
  this.$ = document.createElement("input");
  defineProperties( this, args );
  bindInputEvents( this );
}

module.exports = Input;


function defineProperties( that, args ) {
  var input = that.$;
  Binding.defProps( that, {
    action: null,
    value: function(v) { input.value = v; },
    type: function(v) { input.type = v; },
    hidden: {
      set: function(v) { input.hidden = v; },
      cast: require("tfw.converter.boolean")()
    },
    placeholder: function(v) { input.placeholder = v; },
    focus: function(v) {
      if( v ) input.focus();
      else input.blur();
    }
  }, args );
}

function bindInputEvents( that ) {
  var input = that.$;
  on( input, {
    "input": function() { that.value = input.value; },
    "focus": function() { that.focus = true; },
    "blur": function() { that.focus = false; },
    "keydown": function(evt) {
      if( evt.key == 'Enter' || evt.kecCode == 13 ) {
        that.action = 1;
      }
    }
  } );
}

function on( obj, events ) {
  var name, action;
  for( name in events ) {
    action = events[name];
    obj.addEventListener( name, action, false );
  }
}
